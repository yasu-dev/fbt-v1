# eBay販売後の出荷業務フロー詳細

## 概要
本ドキュメントは、eBayで商品が売れた後にAPIで出荷指示がシステムに届いてから、実際に配送業者に商品を発送するまでの詳細な業務フローと、スタッフが使用するシステムの操作方法を説明します。

## 1. 全体フロー図

```
[eBay API] 
    ↓ 購入通知
[システム受信]
    ↓ 自動処理
[タスク生成]
    ↓ スタッフ通知
[ピッキング作業]
    ↓
[検品作業]
    ↓
[梱包作業]
    ↓
[伝票発行]
    ↓
[配送業者集荷]
    ↓
[配送完了]
```

## 2. eBay APIからの購入通知受信

### 2.1 システムの自動処理
- **エンドポイント**: `/api/orders/route.ts`
- **処理内容**:
  - eBay APIから購入情報を受信
  - 注文データをデータベースに保存
  - 注文ステータス: `pending` → `confirmed`
  - 商品ステータス: `storage` → `ordered`

### 2.2 リアルタイム通知
- **通知システム**: Server-Sent Events (SSE)
- **エンドポイント**: `/api/notifications/stream/route.ts`
- **通知対象**: スタッフのみ
- **通知内容**:
  - 新規注文の発生
  - 商品情報（名前、SKU、価格）
  - 配送先情報
  - 配送希望日時

## 3. ピッキング作業

### 3.1 タスクの自動生成
購入通知を受信すると、システムが自動的にピッキングタスクを生成します。

### 3.2 スタッフの操作手順

#### ステップ1: ダッシュボードで通知確認
1. **URL**: `/staff/dashboard`
2. **確認項目**:
   - 画面上部に表示される「緊急タスク」の件数
   - リアルタイム通知エリアの新規注文アラート

#### ステップ2: ピッキングページへ移動
1. **URL**: `/staff/picking`
2. **画面構成**:
   - 左側: ピッキングリスト一覧
   - 右側: 選択したリストの詳細

#### ステップ3: ピッキングタスクの開始
1. **タスク選択**: リストから該当する注文をクリック
2. **「開始」ボタン**: クリックしてタスクを開始
   - ステータス: `pending` → `in_progress`
   - 担当者: 自動的に現在のスタッフが記録される

#### ステップ4: 商品の収集
1. **倉庫内位置の確認**:
   ```
   倉庫エリアコード:
   - STD-A-01～04: カメラ本体エリア（標準保管）
   - HUM-01～06: レンズエリア（湿度管理あり）
   - DRY-01～02: アクセサリーエリア（乾燥剤使用）
   - TEMP-01～03: 温度管理エリア（精密機器用）
   - V-01～20: 貴重品エリア（施錠管理）
   ```

2. **ピッキング手順**:
   - 表示された位置（例: A-01）へ移動
   - 商品を確認・収集
   - 「ピック完了」ボタンをクリック
   - ステータス: `pending` → `completed`

#### ステップ5: 全商品のピッキング完了
1. **確認事項**: すべての商品のステータスが「completed」になっているか
2. **「ピッキング完了」ボタン**: クリックして次工程へ
3. **システム通知**: 「ピッキングが完了しました（倉庫保管中）」

### 3.3 複数商品の注文の場合
- バッチピッキング機能を使用可能
- 最大50件まで同時処理可能
- 効率的なルート提案機能あり

## 4. 検品・梱包作業

### 4.1 出荷管理ページへの移動
1. **URL**: `/staff/shipping`
2. **画面構成**:
   - 上部: 統計情報（総件数、検品待ち、出荷準備完了、緊急案件）
   - 中部: フィルター機能
   - 下部: 出荷案件一覧

### 4.2 検品作業

#### ステップ1: 商品の選択
1. **一覧から選択**: 「検品待ち」ステータスの商品を探す
2. **「詳細」ボタン**: クリックして詳細モーダルを開く

#### ステップ2: バーコードスキャン
1. **バーコードスキャナー起動**: 画面上部の「バーコード」ボタンをクリック
2. **スキャン実行**:
   - 商品のバーコードをスキャン
   - システムが自動的に商品を識別
   - 正しい商品の場合: 「商品発見」通知
   - 間違った商品の場合: 「商品未発見」警告

#### ステップ3: 検品チェック
1. **外観確認**:
   - キズ、汚れ、破損の有無
   - 付属品の確認
2. **動作確認**（カメラ・レンズの場合）:
   - 電源ON/OFF
   - 基本動作チェック
3. **検品メモ入力**: 特記事項があれば記録

#### ステップ4: 検品完了
1. **「検品完了」ボタン**: クリック
2. **ステータス更新**: `pending_inspection` → `inspected`

### 4.3 梱包作業

#### ステップ1: 梱包指示の確認
1. **「梱包指示」ボタン**: クリックして梱包モーダルを開く
2. **システム推奨の確認**:
   - 推奨梱包材（商品特性に応じて自動選択）
   - 特別な取り扱い指示（高額商品の場合）

#### ステップ2: 梱包材の選択
```
標準梱包材:
- プチプチ: 基本緩衝材
- 小箱: 小物・アクセサリー用
- 中箱: カメラ本体・レンズ用
- 大箱: 複数商品・大型商品用
- 緩衝材: 隙間埋め用
- 梱包テープ: 封緘用

高額商品（50万円以上）の特別梱包:
- 二重梱包必須
- 「取扱注意」シール貼付
- 保険付き配送を選択
```

#### ステップ3: 梱包実施
1. **梱包手順**:
   - 商品を緩衝材で包む
   - 箱に入れて隙間を埋める
   - 納品書を同梱
   - テープで封緘

#### ステップ4: 梱包完了
1. **「梱包完了」ボタン**: クリック
2. **ステータス更新**: `inspected` → `packed`
3. **システム通知**: 「梱包が完了しました（倉庫保管中）」

## 5. 配送伝票発行と出荷処理

### 5.1 配送業者の選択
1. **配送設定確認**: 画面上部の「配送設定」ボタンから確認
2. **利用可能な配送業者**:
   ```
   国内配送:
   - ヤマト運輸（標準/保険付き）
   - 佐川急便
   - 日本郵便（ゆうパック）
   
   国際配送:
   - FedEx
   - DHL Express
   - UPS
   ```

### 5.2 配送ラベルの生成

#### ステップ1: ラベル印刷の準備
1. **「ラベル印刷」ボタン**: 詳細モーダル内でクリック
2. **印刷設定**:
   - 用紙サイズ: A4
   - 印刷枚数: 1枚（控え用に2枚推奨）

#### ステップ2: PDF生成
- **エンドポイント**: `/api/pdf/generate/route.ts`
- **生成内容**:
  - 配送先情報
  - 差出人情報
  - 商品情報
  - バーコード（配送業者用）
  - 追跡番号

#### ステップ3: ラベル貼付
1. **印刷したラベルを商品に貼付**
2. **控えは事務所で保管**

### 5.3 出荷処理の完了

#### ステップ1: 追跡番号の登録
1. **追跡番号入力**: 配送業者から提供された番号を入力
2. **配送業者選択**: ドロップダウンから選択
3. **配送方法確認**: 通常/速達/保険付きなど

#### ステップ2: 出荷完了処理
1. **「出荷完了」ボタン**: クリック
2. **システム処理**:
   - 注文ステータス: `processing` → `shipped`
   - 商品ステータス: `ordered` → `shipping`
   - 追跡番号の保存
   - 出荷日時の記録

#### ステップ3: 通知の送信
- **顧客への通知**: 追跡番号付きの出荷完了メール（自動送信）
- **セラーへの通知**: ダッシュボードに出荷完了を表示

## 6. 配送業者への引き渡し

### 6.1 集荷依頼
1. **集荷管理**: 各配送業者の管理画面から集荷依頼
2. **集荷時間**: 通常15:00～17:00（業者により異なる）

### 6.2 引き渡し時の確認
1. **伝票控えの受領**: 配送業者から受け取る
2. **集荷リストとの照合**: 漏れがないか確認
3. **システムへの記録**: 集荷完了をシステムに記録

## 7. 配送追跡と完了処理

### 7.1 配送状況の追跡
- **自動追跡**: システムが定期的に配送状況を更新
- **手動確認**: 必要に応じて配送業者のサイトで確認

### 7.2 配送完了の処理
1. **配送完了通知**: 配送業者からの通知を受信
2. **ステータス更新**:
   - 注文ステータス: `shipped` → `delivered`
   - 商品ステータス: `shipping` → `sold`
3. **完了記録**: 配送完了日時の記録

## 8. イレギュラー対応

### 8.1 在庫不一致の場合
1. **システムアラート**: 自動的に通知される
2. **対応手順**:
   - 実在庫の再確認
   - システム在庫の修正
   - 代替商品の提案（可能な場合）

### 8.2 配送トラブルの場合
1. **返送された場合**: 再配送の手配
2. **破損クレームの場合**: 保険請求手続き
3. **紛失の場合**: 配送業者との調査協力

## 9. 効率化のポイント

### 9.1 バッチ処理の活用
- 同じ配送先の商品はまとめて処理
- 同じ配送業者の商品は一括で伝票発行

### 9.2 優先順位の管理
- 「緊急」フラグの商品を最優先
- 配送期限の近い商品から処理
- 高額商品は慎重に、確実に処理

### 9.3 作業の標準化
- チェックリストの活用
- 梱包材の事前準備
- 定期的な在庫確認

## 10. KPI管理

### 10.1 重要指標
- **ピッキング精度**: 目標99.5%以上
- **出荷リードタイム**: 受注から24時間以内
- **配送事故率**: 0.1%以下
- **顧客満足度**: 95%以上

### 10.2 日次確認事項
- 当日の出荷予定数
- 緊急案件の有無
- 在庫不足商品の確認
- 梱包材の在庫確認

## まとめ

この出荷業務フローは、eBayでの販売成立から配送完了まで、すべてのプロセスをカバーしています。スタッフは各ステップで明確な作業指示に従い、システムのサポートを受けながら効率的かつ正確に業務を遂行できます。

重要なのは、各工程での確認作業を怠らず、特に高額商品については慎重に取り扱うことです。また、システムの自動化機能を最大限活用することで、ヒューマンエラーを最小限に抑えることができます。