# 現在の出荷業務フロー

## 概要
本システムにおける出荷業務は、eBayで注文が入った後の商品の物流処理を管理します。
業務は大きく2つのフェーズに分かれています：

1. **ピッキング業務** - eBay注文商品を倉庫から取り出す作業
2. **梱包発送業務** - 商品を検品・梱包し、配送準備を行う作業

## 1. 業務フローの全体像

```
[eBay注文受信]
     ↓
[システム自動処理]
     ↓
┌─────────────────┐
│  ピッキング業務  │ ← スタッフが `/staff/picking` で作業
└─────────────────┘
     ↓
┌─────────────────┐
│  梱包発送業務    │ ← スタッフが `/staff/shipping` で作業
└─────────────────┘
     ↓
[配送業者へ引き渡し]
```

## 2. ピッキング業務（第1フェーズ）

### 2.1 概要
- **目的**: eBayで売れた商品を倉庫の棚から取り出す
- **作業場所**: `/staff/picking` ページ
- **終了状態**: 商品が「梱包待ち」ステータスになる

### 2.2 作業フロー

#### ステップ1: ピッキングリストの確認
1. スタッフは `/staff/picking` ページにアクセス
2. 画面に表示される統計情報を確認：
   - ピッキング待ち件数
   - 梱包待ち件数  
   - 出荷完了件数
   - 同梱可能グループ数

#### ステップ2: 商品のピッキング
1. ピッキングリストから商品を選択
2. 商品情報を確認：
   - 商品名（例：Canon EOS R5 ボディ）
   - SKU（例：CAM-001）
   - 保管場所（例：A-01、B-15、V-03）
   - 注文番号
   - 購入者情報

3. 倉庫の指定された場所へ移動し、商品をピックアップ

#### ステップ3: ピッキング完了処理
1. 「ピッキング開始」→「梱包待ち」ボタンをクリック
2. ステータスが `pending` → `ready_for_packing` に変更
3. 商品は梱包エリアへ移動される

### 2.3 特徴的な機能
- **同梱可能グループ**: 同一購入者・同一日付の注文を自動検出
- **バッチピッキング**: 複数商品を一度に選択して処理可能
- **場所表示**: 各商品の倉庫内位置（A-01、V-03など）を明確に表示

## 3. 梱包発送業務（第2フェーズ）

### 3.1 概要
- **目的**: 商品を検品・梱包し、伝票を作成して発送準備を完了する
- **作業場所**: `/staff/shipping` ページ  
- **終了状態**: 商品が発送エリアに保管され、配送業者の集荷を待つ

### 3.2 作業ステータスの流れ

```
pending_inspection（検品待ち）
     ↓
inspected（検品済み）
     ↓
packed（梱包済み）
     ↓
ready_for_pickup（集荷準備中）
     ↓
shipped（発送済み）
     ↓
delivered（配送完了）
```

### 3.3 作業フロー

#### ステップ1: 出荷管理画面での作業開始
1. スタッフは `/staff/shipping` ページにアクセス
2. タブビューで作業対象を選択：
   - 全体
   - 検品待ち
   - 梱包待ち
   - 出荷待ち
   - 集荷準備中
   - 本日出荷

#### ステップ2: 検品作業
1. 「検品待ち」タブから商品を選択
2. 商品の物理的な確認：
   - 外観チェック（キズ、汚れ）
   - 付属品の確認
   - 動作確認（必要に応じて）
3. 「検品完了」ボタンをクリック
4. ステータス: `pending_inspection` → `inspected`

#### ステップ3: 梱包作業
1. 検品済み商品の「梱包」ボタンをクリック
2. 梱包指示に従って作業：
   - 適切な梱包材の選択
   - 商品の保護包装
   - 納品書の同梱
   - 高額商品（50万円以上）は特別梱包
3. オプション：梱包動画の記録（品質管理用）
4. 「梱包完了」処理
5. ステータス: `inspected` → `packed`

#### ステップ4: 伝票作成と出荷準備
1. 梱包済み商品の「ラベル」ボタンをクリック
2. 配送ラベルのPDF生成・印刷
3. 印刷した伝票を梱包に貼付
4. 配送業者の選択：
   - ヤマト運輸（標準/保険付き）
   - 佐川急便
   - 日本郵便
   - FedEx/DHL/UPS（国際配送）
5. 追跡番号の登録（セラーまたはWorldDoorからアップロード可能）
6. 「出荷」ボタンをクリック
7. ステータス: `packed` → `ready_for_pickup`

#### ステップ5: 発送エリアへの保管
1. 伝票を貼付した商品を発送エリアへ移動
2. 配送業者別に仕分けして保管
3. 集荷時間まで一時保管

### 3.4 特徴的な機能
- **インライン作業**: リスト画面から直接各作業を実行可能
- **詳細モーダル**: 商品の詳細情報、画像、保管場所を確認
- **優先度管理**: 緊急・通常・低の3段階で管理
- **高額商品アラート**: 50万円以上の商品は特別な注意喚起
- **一括処理**: 複数商品を選択して同時処理

## 4. システムの特徴

### 4.1 リアルタイム性
- Server-Sent Events (SSE) による即時通知
- ステータス変更の即時反映

### 4.2 効率化機能
- バーコードスキャンによる商品確認
- 同梱可能商品の自動グループ化
- ワークフロープログレスの可視化

### 4.3 品質管理
- 検品チェックリスト
- 梱包動画記録（オプション）
- 高額商品の特別管理フロー

## 5. データの流れ

1. **eBay API** → 注文データ受信
2. **ピッキングAPI** (`/api/picking`) → ピッキングタスク管理
3. **出荷API** (`/api/shipping`) → 出荷ステータス管理
4. **ワークフローAPI** (`/api/shipping/workflow`) → 進捗追跡
5. **通知API** (`/api/notifications/stream`) → リアルタイム通知

## 6. まとめ

現在のシステムは、出荷業務を明確に2つのフェーズに分けることで、作業の専門化と効率化を実現しています：

- **ピッキング業務**: 商品の収集に特化し、倉庫作業の効率を最大化
- **梱包発送業務**: 品質確認と配送準備に集中し、顧客満足度を確保

各フェーズは独立したインターフェースを持ちながら、シームレスに連携することで、eBay注文から配送完了まで一貫した業務フローを実現しています。