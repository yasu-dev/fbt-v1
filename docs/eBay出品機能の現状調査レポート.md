# eBay出品機能の現状調査レポート

## 調査概要
本レポートは、検品完了からeBay出品までの業務フロー、システム機能、および動線について現状を調査・整理したものです。

## 1. 出品に関わる役割と権限

### 1.1 スタッフ（Staff）
- **権限**: eBay出品の全機能へのアクセス権
- **役割**: 実際の出品作業を担当
- **アクセス可能な機能**:
  - 出品管理画面（`/staff/listing`）
  - 在庫管理画面での出品操作
  - テンプレート管理
  - 一括出品機能
  - 自動出品設定

### 1.2 セラー（Seller）
- **権限**: 出品機能へのアクセス権なし
- **役割**: 商品の登録・在庫状況の確認のみ
- **制限事項**:
  - eBay出品機能は利用不可
  - 在庫管理画面での出品ボタンは表示されない
  - 出品状況の確認のみ可能

## 2. 検品完了から出品までの業務フロー

### 2.1 出品可能条件
商品が出品可能になるための条件（`lib/utils/listing-eligibility.ts`より）:
1. **ステータス**: 「保管中（storage）」であること（必須）
2. **検品**: 完了していること（必須）
3. **撮影**: 完了していることが推奨（必須ではない）

### 2.2 業務フローの流れ
```
検品完了 → 保管中ステータス → スタッフが出品判断 → eBay出品
```

### 2.3 出品フォームの作成者
- **作成者**: スタッフのみ
- **フォーム内容**:
  - テンプレート選択（カメラ、レンズ、腕時計、アクセサリー）
  - 価格設定（開始価格、即決価格）
  - カスタムタイトル・説明文（任意）

## 3. システム機能の配置

### 3.1 スタッフ側の機能配置

#### 出品管理画面（`/staff/listing`）
- **アクセス方法**:
  1. 直接URL入力
  2. 業務フローのSTEP 3から遷移
  3. 在庫管理画面から遷移
- **主要機能**:
  - 商品リスト表示（出品可能・出品中商品）
  - 個別出品ボタン
  - 一括出品機能
  - テンプレート管理

#### 在庫管理画面（`/staff/inventory`）
- **出品関連機能**:
  - 商品詳細モーダルに「出品する」ボタン
  - 出品可能商品のフィルタリング
  - 出品ステータスの表示

### 3.2 セラー側の機能配置

#### 在庫管理画面（`/inventory`）
- **利用可能機能**:
  - 在庫一覧の閲覧
  - 商品登録
  - ステータス確認（出品中かどうかの確認のみ）
- **利用不可機能**:
  - 出品ボタン（表示されない）
  - 出品管理機能全般

## 4. 動線設計

### 4.1 スタッフの出品動線

#### パターン1: 業務フローからの動線
1. ダッシュボード → 業務フロー確認
2. STEP 3（販売フェーズ）をクリック
3. 在庫管理画面（出品可能フィルター適用済み）
4. 商品選択 → 詳細モーダル
5. 「出品する」ボタン → 出品フォーム
6. 出品実行

#### パターン2: 直接アクセス動線
1. サイドバー → 在庫管理
2. 商品一覧から出品可能商品を探す
3. 商品詳細 → 「出品する」ボタン
4. 出品フォーム → 出品実行

#### パターン3: 出品管理画面経由
1. URL直接入力または他画面から遷移
2. 出品管理画面で商品リスト確認
3. 個別または一括で出品実行

### 4.2 セラーの動線
- セラーには出品への動線は存在しない
- 在庫管理で出品状況の確認のみ可能

## 5. API構成

### 5.1 主要API
- **`/api/ebay/listing/route.ts`**
  - POST: 出品実行（スタッフ・管理者のみ）
  - GET: テンプレート取得（スタッフ・管理者のみ）
  - 商品ステータスを「listing」に更新
  - アクティビティログの記録

### 5.2 セキュリティ
- すべての出品APIはロールベース認証を実装
- セラーロールでのアクセスは拒否される

## 6. 出品テンプレート

### 6.1 テンプレート種類
1. **カメラ本体用**（camera）
2. **レンズ用**（lens）
3. **腕時計用**（watch）
4. **アクセサリー用**（accessory）

### 6.2 テンプレート内容
- 商品タイトルフォーマット
- HTML形式の説明文
- eBayカテゴリーID
- 配送設定
- 返品ポリシー

## 7. 自動出品機能

### 7.1 設定
- スタッフのみ設定可能
- 写真撮影完了後に自動出品
- 利益率設定
- 価格設定方法（手動/市場連動）

### 7.2 動作
- 条件を満たした商品を自動的にeBayに出品
- カテゴリーに応じたテンプレート自動選択

## まとめ

### 現状の特徴
1. **完全な役割分離**: セラーは出品不可、スタッフのみ出品可能
2. **品質管理**: スタッフによる出品前確認で品質を担保
3. **効率化**: テンプレート機能と自動出品で作業効率化
4. **透明性**: セラーは出品状況を確認可能

### 業務フローの要点
- 検品完了 → 保管中ステータス → スタッフ判断 → eBay出品
- セラーは商品登録と状況確認のみ
- スタッフが出品の全責任を持つ設計