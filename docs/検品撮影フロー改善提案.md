# 検品・撮影フロー改善提案

## 概要

現状の検品・撮影フローは業務として統合されており、よく設計されている。この基本構造は維持しつつ、作業の柔軟性を向上させるための改善案を提案する。

## 現状分析

### 検品作業画面への導線

1. **在庫管理画面** (`/staff/inventory`)
   - ItemDetailModalの「検品開始」ボタン → `/staff/inspection/{productId}`へ遷移
   - 条件：商品ステータスが`inbound`または`storage`

2. **検品管理画面** (`/staff/inspection`)
   - `pending_inspection`ステータス：「検品開始」ボタン → 簡易検品モーダル
   - `inspecting`ステータス：「続ける」リンク → `/staff/inspection/{productId}`へ遷移

3. **返品管理画面** (`/staff/returns`)
   - `pending`ステータス：「検品開始」ボタン → 再出品モーダル

### 検品・撮影の統合状況

**InspectionFormのステップ構成：**
1. Step 0: 基本情報
2. Step 1: 検品項目
3. Step 2: 動画記録
4. Step 3: 写真撮影（PhotoUploader使用）
5. Step 4: 確認・完了

**現状の問題点：**
- 検品と撮影が常に一連のフローとして実行される
- 撮影を後回しにできない（最低1枚の写真が必須）
- 撮影のみを独立して行う導線がない
- 導線が複数あり、統一感に欠ける

## 改善提案

### 1. 基本方針

- **検品・撮影は一つの業務単位として維持**
- **作業レベルでの分離を可能にする**
- **既存の業務フローは大きく変更しない**

### 2. InspectionFormの改善

#### 2.1 写真撮影ステップの柔軟化

```typescript
// InspectionForm.tsx の Step 3（写真撮影）に以下のオプションを追加

interface PhotoStepOptions {
  skipPhotography?: boolean;  // 撮影をスキップ
  minPhotosRequired: number;   // 最小必要枚数（0を許可）
}
```

#### 2.2 検品完了時の選択肢

検品完了（Step 4）で以下の選択肢を提供：
- **検品・撮影完了** - 通常フロー（現状維持）
- **検品のみ完了（撮影は後で）** - 検品結果を保存し、撮影待ちステータスへ

### 3. ステータス管理の拡張

現在のステータスを細分化せず、メタデータで管理：

```typescript
interface InspectionStatus {
  status: 'pending_inspection' | 'inspecting' | 'completed' | 'failed';
  metadata: {
    inspectionCompleted?: boolean;
    photographyCompleted?: boolean;
    inspectionDate?: string;
    photographyDate?: string;
  }
}
```

### 4. UI/UXの改善案

#### 4.1 商品詳細画面での表示

ItemDetailModalに以下のアクションボタンを条件付きで表示：

```typescript
// 表示ロジック
if (status === 'inbound' || status === 'storage') {
  // 「検品開始」ボタン（現状通り）
} else if (status === 'completed' && !metadata.photographyCompleted) {
  // 「撮影する」ボタンを追加表示
} else if (status === 'completed' && metadata.photographyCompleted) {
  // 「出品準備」ボタン
}
```

#### 4.2 検品管理画面の拡張

フィルターオプションに追加：
- 「撮影待ち」（検品完了・撮影未完了）
- 「撮影完了」（検品・撮影両方完了）

#### 4.3 撮影専用エントリーポイント

検品完了済み商品の撮影用に、以下の導線を追加：
- `/staff/inspection/{productId}?mode=photography` 
- InspectionFormを撮影ステップ（Step 3）から開始

### 5. 実装における注意点

1. **バリデーションの調整**
   - 検品のみ完了時は写真0枚を許可
   - 最終的な出品前には写真必須を維持

2. **履歴管理**
   - 検品実施日時と撮影実施日時を別々に記録
   - 作業者情報も個別に保存

3. **業務フローの整合性**
   - 検品・撮影の一体的な業務フローは維持
   - 分離はあくまでオプション機能として提供

### 6. 導線の統一化提案

現在分散している検品開始の導線を統一：

1. **すべての「検品開始」を`/staff/inspection/{productId}`へ統一**
   - 在庫管理画面：現状通り
   - 検品管理画面：モーダルではなくページ遷移へ
   - 返品管理画面：検品フローへ統合

2. **検品管理画面の役割明確化**
   - 検品・撮影タスクの一覧管理
   - ステータスフィルタリング
   - 一括操作機能

## まとめ

本提案は、現在の優れた業務フロー設計を維持しながら、作業の柔軟性を向上させることを目的としている。検品と撮影を一つの業務単位として扱いつつ、現場の状況に応じて作業を分離できるようにすることで、効率的な倉庫運営を支援する。