import { test, expect } from '@playwright/test';

test.describe('UI‰øÆÂæ©Á¢∫Ë™ç„ÉÜ„Çπ„Éà', () => {
  test('„ÉÄ„ÉÉ„Ç∑„É•„Éú„Éº„Éâ„Éö„Éº„Ç∏„ÅÆUIË°®Á§∫Á¢∫Ë™ç', async ({ page }) => {
    // „ÉÄ„ÉÉ„Ç∑„É•„Éú„Éº„Éâ„Éö„Éº„Ç∏„Å´ÁßªÂãï
    await page.goto('http://localhost:3001/dashboard');
    
    // „Éö„Éº„Ç∏„Çø„Ç§„Éà„É´„ÅåË°®Á§∫„Åï„Çå„Çã„Åì„Å®„ÇíÁ¢∫Ë™ç
    await expect(page.locator('h1')).toBeVisible();
    
    // intelligence-card„ÅåË°®Á§∫„Åï„Çå„Çã„Åì„Å®„ÇíÁ¢∫Ë™ç
    await expect(page.locator('.intelligence-card').first()).toBeVisible();
    
    // „Çπ„ÇØ„É≠„Éº„É´„ÅåÊ©üËÉΩ„Åô„Çã„Åì„Å®„ÇíÁ¢∫Ë™ç
    await page.evaluate(() => window.scrollTo(0, 500));
    await page.waitForTimeout(1000);
    
    console.log('‚úÖ „ÉÄ„ÉÉ„Ç∑„É•„Éú„Éº„Éâ„Éö„Éº„Ç∏„ÅÆUIË°®Á§∫Á¢∫Ë™çÂÆå‰∫Ü');
  });

  test('Âú®Â∫´ÁÆ°ÁêÜ„Éö„Éº„Ç∏„ÅÆUIË°®Á§∫Á¢∫Ë™ç', async ({ page }) => {
    // Âú®Â∫´ÁÆ°ÁêÜ„Éö„Éº„Ç∏„Å´ÁßªÂãï
    await page.goto('http://localhost:3001/inventory');
    
    // „Éö„Éº„Ç∏„ÅåË™≠„ÅøËæº„Åæ„Çå„Çã„Åì„Å®„ÇíÁ¢∫Ë™ç
    await expect(page.locator('h1')).toBeVisible();
    
    // „É°„Éà„É™„ÇØ„Çπ„Ç´„Éº„Éâ„ÅåË°®Á§∫„Åï„Çå„Çã„Åì„Å®„ÇíÁ¢∫Ë™ç
    await expect(page.locator('.intelligence-metrics').first()).toBeVisible();
    
    console.log('‚úÖ Âú®Â∫´ÁÆ°ÁêÜ„Éö„Éº„Ç∏„ÅÆUIË°®Á§∫Á¢∫Ë™çÂÆå‰∫Ü');
  });

  test('„Çπ„Çø„ÉÉ„Éï„ÉÄ„ÉÉ„Ç∑„É•„Éú„Éº„Éâ„Éö„Éº„Ç∏„ÅÆUIË°®Á§∫Á¢∫Ë™ç', async ({ page }) => {
    // „Çπ„Çø„ÉÉ„Éï„ÉÄ„ÉÉ„Ç∑„É•„Éú„Éº„Éâ„Éö„Éº„Ç∏„Å´ÁßªÂãï
    await page.goto('http://localhost:3001/staff/dashboard');
    
    // „Éö„Éº„Ç∏„ÅåË™≠„ÅøËæº„Åæ„Çå„Çã„Åì„Å®„ÇíÁ¢∫Ë™ç
    await expect(page.locator('h1')).toBeVisible();
    
    // intelligence-card„ÅåË°®Á§∫„Åï„Çå„Çã„Åì„Å®„ÇíÁ¢∫Ë™ç
    await expect(page.locator('.intelligence-card').first()).toBeVisible();
    
    console.log('‚úÖ „Çπ„Çø„ÉÉ„Éï„ÉÄ„ÉÉ„Ç∑„É•„Éú„Éº„Éâ„Éö„Éº„Ç∏„ÅÆUIË°®Á§∫Á¢∫Ë™çÂÆå‰∫Ü');
  });

  test('Ê®™ÂπÖÂà∂Âæ°„ÅÆÁ¢∫Ë™ç', async ({ page }) => {
    await page.goto('http://localhost:3001/dashboard');
    
    // „Éö„Éº„Ç∏„Ç≥„É≥„ÉÜ„Éä„ÅÆÊúÄÂ§ßÂπÖ„ÅåÈÅ©Âàá„Å´Ë®≠ÂÆö„Åï„Çå„Å¶„ÅÑ„Çã„Åì„Å®„ÇíÁ¢∫Ë™ç
    const container = page.locator('.page-scroll-container > div').first();
    await expect(container).toHaveCSS('max-width', '1600px');
    
    console.log('‚úÖ Ê®™ÂπÖÂà∂Âæ°„ÅÆÁ¢∫Ë™çÂÆå‰∫Ü');
  });

  test('„Çπ„ÇØ„É≠„Éº„É´Ê©üËÉΩ„ÅÆÁ¢∫Ë™ç', async ({ page }) => {
    await page.goto('http://localhost:3001/test-scroll');
    
    // „Çπ„ÇØ„É≠„Éº„É´„ÉÜ„Çπ„Éà„Éö„Éº„Ç∏„Åß„Çπ„ÇØ„É≠„Éº„É´„ÅåÊ©üËÉΩ„Åô„Çã„Åì„Å®„ÇíÁ¢∫Ë™ç
    await page.evaluate(() => window.scrollTo(0, 1000));
    await page.waitForTimeout(500);
    
    const scrollTop = await page.evaluate(() => window.pageYOffset);
    expect(scrollTop).toBeGreaterThan(0);
    
    console.log('‚úÖ „Çπ„ÇØ„É≠„Éº„É´Ê©üËÉΩ„ÅÆÁ¢∫Ë™çÂÆå‰∫Ü');
  });
}); 

test.describe('üîß „Éâ„É≠„ÉÉ„Éó„ÉÄ„Ç¶„É≥„É°„Éã„É•„Éºz-index‰øÆÊ≠£Ê§úË®º', () => {
  test.beforeEach(async ({ page }) => {
    // „Çπ„Çø„ÉÉ„Éï„ÉÄ„ÉÉ„Ç∑„É•„Éú„Éº„Éâ„Å´ÁßªÂãï
    await page.goto('/staff/dashboard');
    await page.waitForLoadState('networkidle');
  });

  test('üìã „Éó„É≠„Éï„Ç£„Éº„É´„É°„Éã„É•„Éº„ÅåÊúÄÂâçÈù¢„Å´Ë°®Á§∫„Åï„Çå„Çã', async ({ page }) => {
    // „Éó„É≠„Éï„Ç£„Éº„É´„Éú„Çø„É≥„Çí„ÇØ„É™„ÉÉ„ÇØ
    const profileButton = page.locator('button').filter({ hasText: '„Çπ„Çø„ÉÉ„Éï' }).first();
    await expect(profileButton).toBeVisible();
    await profileButton.click();

    // „Éó„É≠„Éï„Ç£„Éº„É´„É°„Éã„É•„Éº„ÅåË°®Á§∫„Åï„Çå„Çã„Åì„Å®„ÇíÁ¢∫Ë™ç
    const profileMenu = page.locator('[data-testid="profile-menu"]');
    await expect(profileMenu).toBeVisible({ timeout: 5000 });

    // z-index„ÅåÈÅ©Âàá„Å´Ë®≠ÂÆö„Åï„Çå„Å¶„ÅÑ„Çã„Åì„Å®„ÇíÁ¢∫Ë™ç
    const zIndex = await profileMenu.evaluate((el) => {
      const computedStyle = window.getComputedStyle(el);
      console.log('Profile menu z-index:', computedStyle.zIndex);
      return computedStyle.zIndex;
    });
    
    console.log('Actual z-index value:', zIndex);
    
    // z-index „Åå 10000 ‰ª•‰∏ä„Åß„ÅÇ„Çã„Åì„Å®„ÇíÁ¢∫Ë™çÔºàÊñáÂ≠óÂàó„Å®„Åó„Å¶ÊØîËºÉÔºâ
    const zIndexNum = parseInt(zIndex);
    expect(zIndexNum).toBeGreaterThanOrEqual(10000);

    // „É°„Éã„É•„Éº„ÅåÂÆüÈöõ„Å´Ë°®Á§∫„Åï„Çå„Å¶„ÅÑ„Çã„Åì„Å®„ÇíÁ¢∫Ë™ç
    const rect = await profileMenu.boundingBox();
    expect(rect).not.toBeNull();
    expect(rect!.width).toBeGreaterThan(0);
    expect(rect!.height).toBeGreaterThan(0);
  });

  test('üîî ÈÄöÁü•„Éë„Éç„É´„ÅåÊúÄÂâçÈù¢„Å´Ë°®Á§∫„Åï„Çå„Çã', async ({ page }) => {
    // ÈÄöÁü•„Éú„Çø„É≥„Çí„ÇØ„É™„ÉÉ„ÇØ
    const notificationButton = page.locator('button[aria-label="ÈÄöÁü•"]');
    await expect(notificationButton).toBeVisible();
    await notificationButton.click();

    // ÈÄöÁü•„Éë„Éç„É´„ÅåË°®Á§∫„Åï„Çå„Çã„Åì„Å®„ÇíÁ¢∫Ë™ç
    const notificationPanel = page.locator('[data-testid="notification-panel"]');
    await expect(notificationPanel).toBeVisible({ timeout: 5000 });

    // z-index„ÅåÈÅ©Âàá„Å´Ë®≠ÂÆö„Åï„Çå„Å¶„ÅÑ„Çã„Åì„Å®„ÇíÁ¢∫Ë™ç
    const zIndex = await notificationPanel.evaluate((el) => {
      const computedStyle = window.getComputedStyle(el);
      console.log('Notification panel z-index:', computedStyle.zIndex);
      return computedStyle.zIndex;
    });
    
    console.log('Notification panel z-index value:', zIndex);
    const zIndexNum = parseInt(zIndex);
    expect(zIndexNum).toBeGreaterThanOrEqual(10000);
  });

  test('üì¶ Âá∫Ëç∑„Éö„Éº„Ç∏„ÅÆ„Çπ„ÉÜ„Éº„Çø„Çπ„Éâ„É≠„ÉÉ„Éó„ÉÄ„Ç¶„É≥„ÅåÊúÄÂâçÈù¢„Å´Ë°®Á§∫„Åï„Çå„Çã', async ({ page }) => {
    // Âá∫Ëç∑„Éö„Éº„Ç∏„Å´ÁßªÂãï
    await page.goto('/staff/shipping');
    await page.waitForLoadState('networkidle');

    // Áµ±‰∏Ä„Åï„Çå„Åü„Çπ„ÉÜ„Éº„Çø„ÇπÂ§âÊõ¥„Éú„Çø„É≥„ÇíÊé¢„Åó„Å¶„ÇØ„É™„ÉÉ„ÇØ
    const statusButton = page.locator('button').filter({ hasText: '„Çπ„ÉÜ„Éº„Çø„ÇπÂ§âÊõ¥' }).first();
    
    if (await statusButton.isVisible()) {
      await statusButton.click();

      // Áµ±‰∏Ä„Åï„Çå„Åü„Çπ„ÉÜ„Éº„Çø„Çπ„Éâ„É≠„ÉÉ„Éó„ÉÄ„Ç¶„É≥„ÅåË°®Á§∫„Åï„Çå„Çã„Åì„Å®„ÇíÁ¢∫Ë™ç
      const dropdown = page.locator('[data-testid="unified-status-dropdown"]');
      await expect(dropdown).toBeVisible({ timeout: 5000 });

      // z-index„ÅåÈÅ©Âàá„Å´Ë®≠ÂÆö„Åï„Çå„Å¶„ÅÑ„Çã„Åì„Å®„ÇíÁ¢∫Ë™ç
      const zIndex = await dropdown.evaluate((el) => {
        const computedStyle = window.getComputedStyle(el);
        console.log('Unified status dropdown z-index:', computedStyle.zIndex);
        return computedStyle.zIndex;
      });
      
      console.log('Unified status dropdown z-index value:', zIndex);
      const zIndexNum = parseInt(zIndex);
      expect(zIndexNum).toBe(10000);

      // „Éâ„É≠„ÉÉ„Éó„ÉÄ„Ç¶„É≥„ÅÆÂÜÖÂÆπ„ÅåÁµ±‰∏Ä„Åï„Çå„ÅüUI„Éá„Ç∂„Ç§„É≥„Å´„Å™„Å£„Å¶„ÅÑ„Çã„Åì„Å®„ÇíÁ¢∫Ë™ç
      const dropdownHeader = dropdown.locator('text=Ê¨°„ÅÆ„Çπ„ÉÜ„Éº„Çø„Çπ„Å´Â§âÊõ¥');
      await expect(dropdownHeader).toBeVisible();

      // „Çπ„ÉÜ„Éº„Çø„Çπ„Ç™„Éó„Ç∑„Éß„É≥„ÅåË°®Á§∫„Åï„Çå„Çã„Åì„Å®„ÇíÁ¢∫Ë™ç
      const statusOptions = dropdown.locator('.unified-status-option');
      const optionCount = await statusOptions.count();
      expect(optionCount).toBeGreaterThan(0);

      console.log(`Found ${optionCount} status options in unified dropdown`);
    } else {
      console.log('No unified status change button found on shipping page');
      // „Çπ„ÉÜ„Éº„Çø„ÇπÂ§âÊõ¥„Éú„Çø„É≥„ÅåË¶ã„Å§„Åã„Çâ„Å™„ÅÑÂ†¥Âêà„ÅØ„ÉÜ„Çπ„Éà„Çí„Çπ„Ç≠„ÉÉ„Éó
      test.skip();
    }
  });

  test('üèóÔ∏è z-indexÈöéÂ±§„Ç∑„Çπ„ÉÜ„É†„ÅÆÊï¥ÂêàÊÄßÁ¢∫Ë™ç', async ({ page }) => {
    // „Éò„ÉÉ„ÉÄ„Éº„ÅÆz-index„ÇíÁ¢∫Ë™ç
    const header = page.locator('header.nexus-header');
    await expect(header).toBeVisible();
    
    const headerZIndex = await header.evaluate((el) => {
      const computedStyle = window.getComputedStyle(el);
      console.log('Header z-index:', computedStyle.zIndex);
      return computedStyle.zIndex;
    });
    
    console.log('Header z-index value:', headerZIndex);
    // „Éò„ÉÉ„ÉÄ„Éº„Åå z-index 100 „Åß„ÅÇ„Çã„Åì„Å®„ÇíÁ¢∫Ë™ç
    expect(parseInt(headerZIndex)).toBe(100);

    // „Éó„É≠„Éï„Ç£„Éº„É´„É°„Éã„É•„Éº„ÇíÈñã„Åè
    const profileButton = page.locator('button').filter({ hasText: '„Çπ„Çø„ÉÉ„Éï' }).first();
    await profileButton.click();

    const profileMenu = page.locator('[data-testid="profile-menu"]');
    await expect(profileMenu).toBeVisible({ timeout: 5000 });

    const menuZIndex = await profileMenu.evaluate((el) => {
      const computedStyle = window.getComputedStyle(el);
      console.log('Profile menu z-index:', computedStyle.zIndex);
      return computedStyle.zIndex;
    });

    console.log('Profile menu z-index value:', menuZIndex);
    // „Éâ„É≠„ÉÉ„Éó„ÉÄ„Ç¶„É≥„É°„Éã„É•„Éº„Åå„Éò„ÉÉ„ÉÄ„Éº„Çà„ÇäÈ´ò„ÅÑz-index„ÇíÊåÅ„Å§„Åì„Å®„ÇíÁ¢∫Ë™ç
    expect(parseInt(menuZIndex)).toBeGreaterThan(parseInt(headerZIndex));
  });

  test('üéØ Ë§áÊï∞„ÅÆ„Éâ„É≠„ÉÉ„Éó„ÉÄ„Ç¶„É≥„É°„Éã„É•„Éº„ÅÆÈáç„Å≠Âêà„Çè„ÅõÂãï‰Ωú', async ({ page }) => {
    // ÈÄöÁü•„Éë„Éç„É´„ÅÆz-index„ÇíÁ¢∫Ë™ç
    const notificationButton = page.locator('button[aria-label="ÈÄöÁü•"]');
    await notificationButton.click();

    const notificationPanel = page.locator('[data-testid="notification-panel"]');
    await expect(notificationPanel).toBeVisible({ timeout: 5000 });

    const notificationZIndex = await notificationPanel.evaluate((el) => {
      return window.getComputedStyle(el).zIndex;
    });

    console.log('Notification z-index:', notificationZIndex);
    expect(parseInt(notificationZIndex)).toBe(10000);

    // ÈÄöÁü•„Éë„Éç„É´„ÇíÈñâ„Åò„ÇãÔºàÈÄöÁü•„Éú„Çø„É≥„ÇíÂÜç„ÇØ„É™„ÉÉ„ÇØÔºâ
    await notificationButton.click();

    // „Éó„É≠„Éï„Ç£„Éº„É´„É°„Éã„É•„Éº„ÅÆz-index„ÇíÁ¢∫Ë™ç
    const profileButton = page.locator('button').filter({ hasText: '„Çπ„Çø„ÉÉ„Éï' }).first();
    await profileButton.click();

    const profileMenu = page.locator('[data-testid="profile-menu"]');
    await expect(profileMenu).toBeVisible({ timeout: 5000 });

    const profileZIndex = await profileMenu.evaluate((el) => {
      return window.getComputedStyle(el).zIndex;
    });

    console.log('Profile z-index:', profileZIndex);
    expect(parseInt(profileZIndex)).toBe(10000);

    // ‰∏°Êñπ„ÅÆ„É°„Éã„É•„Éº„ÅåÂêå„Åòz-indexÈöéÂ±§„Å´„ÅÇ„Çã„Åì„Å®„ÇíÁ¢∫Ë™ç
    expect(parseInt(profileZIndex)).toBe(parseInt(notificationZIndex));
  });
}); 